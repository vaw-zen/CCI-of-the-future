name: ğŸš€ CCI Services - Website Build & Health Check

on:
  push:
    branches: [ main ]
    paths:
      - 'src/app/**'
      - '.github/workflows/**'
      - 'package.json'
      
  workflow_dispatch:
    inputs:
      force_run:
        description: 'Force run build check'
        required: false
        default: false
        type: boolean

# Add permissions for GitHub Actions
permissions:
  contents: read
  actions: read

jobs:
  # Build and deploy check
  build-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: npm install
      
    - name: ğŸ”¨ Build application
      run: npm run build
      
    - name: âœ… Validate Next.js application
      run: |
        echo "âœ… Next.js application built successfully"
        echo "ğŸ“Š Build completed for commit: ${{ github.sha }}"

  # Website health check (lightweight)
  health-check:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch'
    
    steps:
    - name: ğŸ” Basic Website Health Check
      run: |
        echo "ğŸŒ Checking website health..."
        
        # Check main website
        if curl -s --head https://cciservices.online | head -n 1 | grep -q "200 OK"; then
          echo "âœ… Main website is up and running"
        else
          echo "âŒ Main website may be down"
        fi
        
        echo "ğŸ¯ Basic health check completed"
        echo "ğŸ“ Note: Comprehensive monitoring handled by CRM system"